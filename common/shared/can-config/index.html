
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>CAN-bus Configuration - Eagle TRT</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#configuring-of-the-can-bus-on-st-mcus" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Eagle TRT" class="md-header__button md-logo" aria-label="Eagle TRT" data-md-component="logo">
      
  <img src="../../../static/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Eagle TRT
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CAN-bus Configuration
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Eagle TRT" class="md-nav__button md-logo" aria-label="Eagle TRT" data-md-component="logo">
      
  <img src="../../../static/logo.png" alt="logo">

    </a>
    Eagle TRT
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        E-Agle TRT Wiki
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          DAS ECU hw
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DAS ECU hw" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          DAS ECU hw
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DAS_ECU_hw/DAS_ECU/" class="md-nav__link">
        DAS+ECU
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Common
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Common" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Common
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../about/writing-docs/" class="md-nav__link">
        Writing Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          General Documentation Files
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="General Documentation Files" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          General Documentation Files
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          CAN-bus Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        CAN-bus Configuration
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#on-cubemx" class="md-nav__link">
    On CubeMX
  </a>
  
    <nav class="md-nav" aria-label="On CubeMX">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activate-the-peripheral" class="md-nav__link">
    Activate the Peripheral
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-the-bit-timing-parameters" class="md-nav__link">
    Set the Bit Timing Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-your-code" class="md-nav__link">
    In Your Code
  </a>
  
    <nav class="md-nav" aria-label="In Your Code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-callback-functions" class="md-nav__link">
    Create the Callback Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activate-the-irq-handlers-notifications" class="md-nav__link">
    Activate the IRQ Handlers ("Notifications")
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activate-and-configure-the-hardware-filters" class="md-nav__link">
    Activate and Configure the Hardware Filters
  </a>
  
    <nav class="md-nav" aria-label="Activate and Configure the Hardware Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id-mask-mode" class="md-nav__link">
    ID Mask Mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id-list-mode" class="md-nav__link">
    ID List Mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code" class="md-nav__link">
    Code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-operations" class="md-nav__link">
    Final Operations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../can-debugging/" class="md-nav__link">
        CAN-bus Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../openocd-errors/" class="md-nav__link">
        OpenOCD Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Fenice bms hv sw
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Fenice bms hv sw" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Fenice bms hv sw
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/" class="md-nav__link">
        High-Voltage Battery Management System
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Mainboard
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mainboard" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Mainboard
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/" class="md-nav__link">
        Mainboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/io/" class="md-nav__link">
        I/O
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_3" type="checkbox" id="__nav_4_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2_3">
          Subsystems
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Subsystems" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_2_3">
          <span class="md-nav__icon md-icon"></span>
          Subsystems
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/subsystems/bal/" class="md-nav__link">
        Cell Balancing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/subsystems/bms_cli/" class="md-nav__link">
        Command Line Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/subsystems/bms_fsm/" class="md-nav__link">
        Main State Machine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/subsystems/config/" class="md-nav__link">
        Config
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          ECU
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ECU" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          ECU
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-ecu/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-ecu/modules/" class="md-nav__link">
        Modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-ecu/fsm/" class="md-nav__link">
        Finite State Machine
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Steering Wheel
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Steering Wheel" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Steering Wheel
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-steeringwheel/" class="md-nav__link">
        Steering Wheel
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-steeringwheel/development/qt/" class="md-nav__link">
        Building Qt for the Raspberry Pi
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          Interface
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Interface" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Interface
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-steeringwheel/interface/tabs/" class="md-nav__link">
        Concept of Tabs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Handcart hw
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Handcart hw" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Handcart hw
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../handcart-hw/handcart/" class="md-nav__link">
        Handcart / Charger
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Handcart Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Handcart Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Handcart Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../handcart-sw/main/" class="md-nav__link">
        Handcart Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#on-cubemx" class="md-nav__link">
    On CubeMX
  </a>
  
    <nav class="md-nav" aria-label="On CubeMX">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activate-the-peripheral" class="md-nav__link">
    Activate the Peripheral
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-the-bit-timing-parameters" class="md-nav__link">
    Set the Bit Timing Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-your-code" class="md-nav__link">
    In Your Code
  </a>
  
    <nav class="md-nav" aria-label="In Your Code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-callback-functions" class="md-nav__link">
    Create the Callback Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activate-the-irq-handlers-notifications" class="md-nav__link">
    Activate the IRQ Handlers ("Notifications")
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activate-and-configure-the-hardware-filters" class="md-nav__link">
    Activate and Configure the Hardware Filters
  </a>
  
    <nav class="md-nav" aria-label="Activate and Configure the Hardware Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id-mask-mode" class="md-nav__link">
    ID Mask Mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id-list-mode" class="md-nav__link">
    ID List Mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code" class="md-nav__link">
    Code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-operations" class="md-nav__link">
    Final Operations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="configuring-of-the-can-bus-on-st-mcus">Configuring of the CAN-bus on ST MCUs</h1>
<h2 id="on-cubemx">On CubeMX</h2>
<h4 id="activate-the-peripheral">Activate the Peripheral</h4>
<p>In CubeMX, expand the "Connectivity" tab on the left pane and click on the CAN interface you wish to activate. A configuration pane will appear on the right; tick the "Activated" checkbox.</p>
<p><img alt="CubeMx Window" src="../imgs/can-mx-1.png" /></p>
<h4 id="set-the-bit-timing-parameters">Set the Bit Timing Parameters</h4>
<p>The sampling of the signal is dictated by a number of parameters that set time constraints for the reading and transmitting instants. The duration of a bit (nominal bit time) is split into four segments: a synchronization segment (SYNC_SEG) to sync all nodes on the network, the first Bit Segment (BS1) to define the location of the sampling point, the second Bit Segment to define the transmit point (BS2), and a resynchronization Jump Width (SJW) that indicates how much segments can be lengthened or shortened to compensate for timing errors or delays. The length of these segments is defined in terms of number of Time Quanta (<span class="arithmatex">\(t_q\)</span>). For a visual representation of the subdivision and the mapping of the values to the registers refer to the image below.</p>
<p><img alt="Subdivision of a nominal bit time into segments" src="../imgs/can-tqs.png" /></p>
<p>To define the duration of a time quanta and the length of the various segments, you need to input your parameters into the "Configuration" panel that appeared in CubeMx from the previous step (below the "Activate" checkbox"). If your parameters are still to be defined, use an online calculator such as <a href="http://www.bittiming.can-wiki.info/">bittiming.can-wiki.info</a> and fill the form; note that selecting the platform is only needed if you're interested in the register mapping, but in any case this website provides a choice for "ST Microelectronics bxCAN" which is our case. Input the clock frequency after checking your Clock Tree in CubeMX for how the relevant bus is configured (in the example below, the bxCAN peripheral is connected to the APB1 bus which is at 54 MHz) and of course that the frequency is high enough to operate at the target link speed.</p>
<p><img alt="Clock Tree" src="../imgs/can-clocktree.png" /></p>
<p>Next, input the desired sample point (the default 87.5% is fine), the SJW duration (the default 1 is fine as well), and the desired bitrate <strong>in kbit/s</strong>. The calculator will generate a table with valid combinations: copy over the values into CubeMX for the Prescaler, BS1, and BS2 (SYNC_SEG is always of length 1 <span class="arithmatex">\(t_q\)</span>) and check that the resulting baud rate is correct.</p>
<p><img alt="Configuration parameters in CubeMX" src="../imgs/can-mx-2.png" /></p>
<p>The last operation left to perform in CubeMX is to activate all CAN interrupts in the NVIC array: in the same panel as above, switch to the "NVIC" tab and tick all checkboxes.</p>
<p><img alt="NVIC activation in CubeMX" src="../imgs/can-mx-3.png" /></p>
<h2 id="in-your-code">In Your Code</h2>
<p>Most of the information that follows is available in the source documentation of the <code>stm32fXxx_hal_can.c</code> driver file, so check there should you need any additional detail. However, much of the process outlined there is handled automatically by CubeMX, so this document should simplify your setup by only describing what has effectively to be done, while also using a less schematic and cryptic approach.</p>
<h4 id="create-the-callback-functions">Create the Callback Functions</h4>
<p>To register callbacks you need to create the relative functions with the proper names (in the form of <code>HAL_CAN_xxxCallback(...)</code>).</p>
<table>
<thead>
<tr>
<th>Callback signature</th>
<th>Action upon which it is invoked</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>void HAL_CAN_RxFifo0MsgPendingCallback(CAN_HandleTypeDef *)</code></td>
<td>A message has been received into FIFO 0 and is ready to be read.</td>
</tr>
<tr>
<td><code>void HAL_CAN_RxFifo1MsgPendingCallback(CAN_HandleTypeDef *)</code></td>
<td>A message has been received into FIFO 1 and is ready to be read.</td>
</tr>
<tr>
<td><code>void HAL_CAN_RxFifo0FullCallback(CAN_HandleTypeDef *)</code></td>
<td>FIFO 0 has reached its full capacity. The next RX will cause an overrun error.</td>
</tr>
<tr>
<td><code>void HAL_CAN_RxFifo1FullCallback(CAN_HandleTypeDef *)</code></td>
<td>FIFO 1 has reached its full capacity. The next RX will cause an overrun error.</td>
</tr>
<tr>
<td><code>void HAL_CAN_TxMailbox0CompleteCallback(CAN_HandleTypeDef *)</code></td>
<td>Mailbox 0 is now clear (a pending TX has ended).</td>
</tr>
<tr>
<td><code>void HAL_CAN_TxMailbox1CompleteCallback(CAN_HandleTypeDef *)</code></td>
<td>Mailbox 1 is now clear (a pending TX has ended).</td>
</tr>
<tr>
<td><code>void HAL_CAN_TxMailbox2CompleteCallback(CAN_HandleTypeDef *)</code></td>
<td>Mailbox 2 is now clear (a pending TX has ended).</td>
</tr>
<tr>
<td><code>void HAL_CAN_ErrorCallback(CAN_HandleTypeDef *)</code></td>
<td>An error in the peripheral has occurred. <strong>Make sure to properly log the raised error code.</strong></td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>For your convenience, here is a prepared Error Callback that verbosely logs any error bit that is high in the error code. <code>CAN_error_handler(...)</code> is a custom sample function that prints the message over UART and lights up a red LED.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">HAL_CAN_ErrorCallback</span><span class="p">(</span><span class="n">CAN_HandleTypeDef</span><span class="w"> </span><span class="o">*</span><span class="n">hcan</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hcan</span><span class="o">-&gt;</span><span class="n">ErrorCode</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_EWG</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Protocol Error Warning&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_EPV</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Error Passive&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_BOF</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Bus-off Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_STF</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Stuff Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_FOR</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Form Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_ACK</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;ACK Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_BR</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Bit Recessive Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_BD</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Bit Dominant Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_CRC</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;CRC Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_RX_FOV0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;FIFO0 Overrun&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_RX_FOV1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;FIFO1 Overrun&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_TX_ALST0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Mailbox 0 TX failure (arbitration lost)&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_TX_TERR0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Mailbox 0 TX failure (tx error)&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_TX_ALST1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Mailbox 1 TX failure (arbitration lost)&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_TX_TERR1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Mailbox 1 TX failure (tx error)&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_TX_ALST2</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Mailbox 2 TX failure (arbitration lost)&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_TX_TERR2</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Mailbox 2 TX failure (tx error)&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_TIMEOUT</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Timeout Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_NOT_INITIALIZED</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Peripheral not initialized&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_NOT_READY</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Peripheral not ready&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_NOT_STARTED</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Peripheral not strated&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">HAL_CAN_ERROR_PARAM</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">CAN_error_handler</span><span class="p">(</span><span class="s">&quot;Parameter Error&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
<h4 id="activate-the-irq-handlers-notifications">Activate the IRQ Handlers ("Notifications")</h4>
<p>At this point, in order for the code to actually invoke your callbacks, you need to activate the relative so-called Notifications with <code>HAL_CAN_ActivateNotification(CAN_HandleTypeDef *, uint32_t)</code>. Possible values for the IRQ number are, as defined in the driver file:</p>
<div class="highlight"><pre><span></span><code><span class="cm">/* Transmit Interrupt */</span><span class="w"></span>
<span class="cp">#define CAN_IT_TX_MAILBOX_EMPTY     ((uint32_t)CAN_IER_TMEIE)   </span><span class="cm">/*!&lt; Transmit mailbox empty interrupt */</span><span class="cp"></span>

<span class="cm">/* Receive Interrupts */</span><span class="w"></span>
<span class="cp">#define CAN_IT_RX_FIFO0_MSG_PENDING ((uint32_t)CAN_IER_FMPIE0)  </span><span class="cm">/*!&lt; FIFO 0 message pending interrupt */</span><span class="cp"></span>
<span class="cp">#define CAN_IT_RX_FIFO0_FULL        ((uint32_t)CAN_IER_FFIE0)   </span><span class="cm">/*!&lt; FIFO 0 full interrupt            */</span><span class="cp"></span>
<span class="cp">#define CAN_IT_RX_FIFO0_OVERRUN     ((uint32_t)CAN_IER_FOVIE0)  </span><span class="cm">/*!&lt; FIFO 0 overrun interrupt         */</span><span class="cp"></span>
<span class="cp">#define CAN_IT_RX_FIFO1_MSG_PENDING ((uint32_t)CAN_IER_FMPIE1)  </span><span class="cm">/*!&lt; FIFO 1 message pending interrupt */</span><span class="cp"></span>
<span class="cp">#define CAN_IT_RX_FIFO1_FULL        ((uint32_t)CAN_IER_FFIE1)   </span><span class="cm">/*!&lt; FIFO 1 full interrupt            */</span><span class="cp"></span>
<span class="cp">#define CAN_IT_RX_FIFO1_OVERRUN     ((uint32_t)CAN_IER_FOVIE1)  </span><span class="cm">/*!&lt; FIFO 1 overrun interrupt         */</span><span class="cp"></span>

<span class="cm">/* Operating Mode Interrupts */</span><span class="w"></span>
<span class="cp">#define CAN_IT_WAKEUP               ((uint32_t)CAN_IER_WKUIE)   </span><span class="cm">/*!&lt; Wake-up interrupt                */</span><span class="cp"></span>
<span class="cp">#define CAN_IT_SLEEP_ACK            ((uint32_t)CAN_IER_SLKIE)   </span><span class="cm">/*!&lt; Sleep acknowledge interrupt      */</span><span class="cp"></span>

<span class="cm">/* Error Interrupts */</span><span class="w"></span>
<span class="cp">#define CAN_IT_ERROR_WARNING        ((uint32_t)CAN_IER_EWGIE)   </span><span class="cm">/*!&lt; Error warning interrupt          */</span><span class="cp"></span>
<span class="cp">#define CAN_IT_ERROR_PASSIVE        ((uint32_t)CAN_IER_EPVIE)   </span><span class="cm">/*!&lt; Error passive interrupt          */</span><span class="cp"></span>
<span class="cp">#define CAN_IT_BUSOFF               ((uint32_t)CAN_IER_BOFIE)   </span><span class="cm">/*!&lt; Bus-off interrupt                */</span><span class="cp"></span>
<span class="cp">#define CAN_IT_LAST_ERROR_CODE      ((uint32_t)CAN_IER_LECIE)   </span><span class="cm">/*!&lt; Last error code interrupt        */</span><span class="cp"></span>
<span class="cp">#define CAN_IT_ERROR                ((uint32_t)CAN_IER_ERRIE)   </span><span class="cm">/*!&lt; Error Interrupt                  */</span><span class="cp"></span>
</code></pre></div>
<p>Note that IRQ numbers can be OR-ed together and be activated many at once. For instance:</p>
<div class="highlight"><pre><span></span><code><span class="n">HAL_CAN_ActivateNotification</span><span class="p">(</span><span class="n">hcan</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">CAN_IT_ERROR_WARNING</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="n">CAN_IT_ERROR_PASSIVE</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="n">CAN_IT_BUSOFF</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="n">CAN_IT_LAST_ERROR_CODE</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="n">CAN_IT_ERROR</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<h4 id="activate-and-configure-the-hardware-filters">Activate and Configure the Hardware Filters</h4>
<p>When a new message is received, CAN nodes can use hardware filters to decide if the message must be copied into SRAM and trigger an IRQ, or if it has to be discarded. The advantage of hardware filters is that unwanted messages don't waste any CPU cycles thus saving potentially a lot of resources, especially on heavy traffic networks with many nodes.</p>
<p>STMs are equipped with a number of filter banks, each of which is composed by two 32-bit registers. Each bank can operate in <strong>ID Mask Mode</strong> or in <strong>ID List Mode</strong>: in the former, one register acts as the mask and the second as the ID, while in the latter mode, both registers represent IDs of the list. Filter banks can also be configured to operate in 16-bit mode, therefore doubling their capacity (four 16-bit registers instead of two 32-bit registers, which are split in two). In ID Mask mode this yields two pairs of Mask+ID, while in ID List mode, of course, it yields 4 ID registers.</p>
<p>For a better understanding of the layout of a filter bank in relation to hardware registers, refer to the image below.</p>
<p><img alt="CAN Filter register" src="../imgs/can-filters.png" /></p>
<h5 id="id-mask-mode">ID Mask Mode</h5>
<p>In this mode the filtering is based on a mask register which tells which bits of the ID register need to be compared with the incoming message ID. For instance, with a mask of <code>11110000000</code> and an ID of <code>01110000000</code>, only messages whose ID begins with <code>0111</code> (<code>0x3</code>) will be accepted. Some more examples follow.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li>
<p>Mask: <code>0b11111111111</code> (<code>0x03FF</code>) <br/>
  ID: <code>0b11111111111</code> (<code>0x03FF</code>) <br/>
  Accepted: only ID == <code>0x03FF</code></p>
</li>
<li>
<p>Mask: <code>0b11111111110</code> (<code>0x03FE</code>) <br/>
  ID: <code>0b11111111110</code> (<code>0x03FE</code>) <br/>
  Accepted: {<code>0x03FE</code>, <code>0x03FF</code>} (as bit 0 of the filter is disabled)</p>
</li>
<li>
<p>Mask: <code>0b11111111000</code> (<code>0x03F8</code>) <br/>
   ID: <code>0b00000000000</code> (<code>0x0000</code>) <br/>
   Accepted: ID from <code>0x000</code> to <code>0x007</code> (as bits 0, 1, 2 of the filter are disabled)</p>
</li>
</ul>
</div>
<h5 id="id-list-mode">ID List Mode</h5>
<p>In ID List Mode, incoming messages' IDs are simply compared for equality with every element of the list.</p>
<h5 id="code">Code</h5>
<p>To configure a filter, you need to allocate and populate a <code>CAN_FilterTypeDef</code> struct and pass it by reference to <code>HAL_CAN_ConfigFilter(...)</code>. Its fields are the following:</p>
<ul>
<li><code>FilterMode</code>: either <code>CAN_FILTERMODE_IDMASK</code> or <code>CAN_FILTERMODE_IDLIST</code>, for the respective modes</li>
<li><code>FilterIdHigh</code>: MSBs of the ID register (or first one of the two 16-bit registers)</li>
<li><code>FilterIdLow</code>: LSBs of the ID register (or second one of the two 16-bit registers)</li>
<li><code>FilterMaskIdHigh</code>: MSBs of the Mask register (or first one of the two 16-bit registers)</li>
<li><code>FilterMaskIdLow</code>: LSBs of the Mask register (or second one of the two 16-bit registers)</li>
<li><code>FilterFIFOAssignment</code>: the queue in which to store messages (a value of <code>CAN_filter_FIFO</code>, e.g. <code>CAN_FILTER_FIFO0</code>)</li>
<li><code>FilterBank</code>: index of the filter bank to be initialized</li>
<li><code>FilterScale</code>: <code>CAN_FILTERSCALE_16BIT</code> or <code>CAN_FILTERSCALE_32BIT</code>, for the respective register scale</li>
<li><code>FilterActivation</code>: <code>ENABLE</code> or <code>DISABLE</code></li>
</ul>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>A filter that accepts everything would look like this:</p>
<div class="highlight"><pre><span></span><code><span class="n">CAN_FilterTypeDef</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"></span>
<span class="n">f</span><span class="p">.</span><span class="n">FilterMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CAN_FILTERMODE_IDMASK</span><span class="p">;</span><span class="w"></span>
<span class="n">f</span><span class="p">.</span><span class="n">FilterIdLow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Meaningless, mask is all 0s</span>
<span class="n">f</span><span class="p">.</span><span class="n">FilterIdHigh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Meaningless, mask is all 0s</span>
<span class="n">f</span><span class="p">.</span><span class="n">FilterMaskIdHigh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0</span><span class="p">;</span><span class="w"></span>
<span class="n">f</span><span class="p">.</span><span class="n">FilterMaskIdLow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0</span><span class="p">;</span><span class="w"></span>
<span class="n">f</span><span class="p">.</span><span class="n">FilterFIFOAssignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CAN_FILTER_FIFO0</span><span class="p">;</span><span class="w"></span>
<span class="n">f</span><span class="p">.</span><span class="n">FilterBank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">f</span><span class="p">.</span><span class="n">FilterScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CAN_FILTERSCALE_32BIT</span><span class="p">;</span><span class="w"></span>
<span class="n">f</span><span class="p">.</span><span class="n">FilterActivation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">;</span><span class="w"></span>

<span class="n">HAL_CAN_ConfigFilter</span><span class="p">(</span><span class="n">hcan</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">f</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
</div>
<h4 id="final-operations">Final Operations</h4>
<p>The last step is to actually start the peripheral by calling <code>HAL_CAN_Start(...)</code>. To use it, send messages with <code>HAL_CAN_AddTxMessage(...)</code> after checking for free mailboxes with <code>HAL_CAN_GetTxMailboxesFreeLevel(...)</code> and read received messages with <code>HAL_CAN_GetRxMessage(...)</code>.</p>
<p>Should anything not work properly, refer to the next document, <a href="../can-debugging/">CAN-bus Troubleshooting</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../about/writing-docs/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Writing Documentation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Writing Documentation
            </div>
          </div>
        </a>
      
      
        
        <a href="../can-debugging/" class="md-footer__link md-footer__link--next" aria-label="Next: CAN-bus Troubleshooting" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              CAN-bus Troubleshooting
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; E-Agle TRT
          </div>
        
        
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/eagletrt" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://github.com/eagletrt" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://hub.docker.com/u/eagletrt" target="_blank" rel="noopener" title="hub.docker.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b1047164.min.js"></script>
      
        <script src="../../../static/js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
      
        <script src="../../../static/js/mermaid.js"></script>
      
    
  </body>
</html>