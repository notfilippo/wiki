
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>CAN-bus Troubleshooting - Eagle TRT</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#can-bus-troubleshooting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Eagle TRT" class="md-header__button md-logo" aria-label="Eagle TRT" data-md-component="logo">
      
  <img src="../../../static/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Eagle TRT
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CAN-bus Troubleshooting
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Eagle TRT" class="md-nav__button md-logo" aria-label="Eagle TRT" data-md-component="logo">
      
  <img src="../../../static/logo.png" alt="logo">

    </a>
    Eagle TRT
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        E-Agle TRT Wiki
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          DAS ECU hw
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DAS ECU hw" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          DAS ECU hw
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DAS_ECU_hw/DAS_ECU/" class="md-nav__link">
        DAS+ECU
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Common
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Common" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Common
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../about/writing-docs/" class="md-nav__link">
        Writing Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          General Documentation Files
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="General Documentation Files" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          General Documentation Files
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../can-config/" class="md-nav__link">
        CAN-bus Configuration
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          CAN-bus Troubleshooting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        CAN-bus Troubleshooting
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-check-your-configuration" class="md-nav__link">
    Step 1: Check Your Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-follow-this-flowchart" class="md-nav__link">
    Step 2: Follow This Flowchart
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-find-more-details-from-the-flowchart" class="md-nav__link">
    Step 3: Find More Details From The Flowchart
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Find More Details From The Flowchart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#can-transceiver-not-communicating-with-the-mcu" class="md-nav__link">
    CAN Transceiver not communicating with the MCU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#termination-resistors-not-present-or-of-incorrect-value" class="md-nav__link">
    Termination resistors not present or of incorrect value
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-of-errors-raised-by-the-hal-library" class="md-nav__link">
    List of errors raised by the HAL library
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clock-skew" class="md-nav__link">
    Clock Skew
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-fifos-or-mailboxes-are-not-properly-cleared" class="md-nav__link">
    Hardware FIFOs or Mailboxes are not properly cleared
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-segmentation-fault-or-other-error-crashes-the-mcu" class="md-nav__link">
    A segmentation fault or other error crashes the MCU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filters-not-configured-properly" class="md-nav__link">
    Filters not configured properly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interrupts-not-configured-properly" class="md-nav__link">
    Interrupts not configured properly
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../openocd-errors/" class="md-nav__link">
        OpenOCD Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Fenice bms hv sw
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Fenice bms hv sw" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Fenice bms hv sw
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/" class="md-nav__link">
        High-Voltage Battery Management System
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Mainboard
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mainboard" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Mainboard
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/" class="md-nav__link">
        Mainboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/io/" class="md-nav__link">
        I/O
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_3" type="checkbox" id="__nav_4_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2_3">
          Subsystems
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Subsystems" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_2_3">
          <span class="md-nav__icon md-icon"></span>
          Subsystems
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/subsystems/bal/" class="md-nav__link">
        Cell Balancing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/subsystems/bms_cli/" class="md-nav__link">
        Command Line Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/subsystems/bms_fsm/" class="md-nav__link">
        Main State Machine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-bms-hv-sw/mainboard/subsystems/config/" class="md-nav__link">
        Config
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          ECU
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ECU" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          ECU
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-ecu/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-ecu/modules/" class="md-nav__link">
        Modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-ecu/fsm/" class="md-nav__link">
        Finite State Machine
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Steering Wheel
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Steering Wheel" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Steering Wheel
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-steeringwheel/" class="md-nav__link">
        Steering Wheel
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-steeringwheel/development/qt/" class="md-nav__link">
        Building Qt for the Raspberry Pi
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          Interface
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Interface" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Interface
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../fenice-steeringwheel/interface/tabs/" class="md-nav__link">
        Concept of Tabs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Handcart hw
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Handcart hw" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Handcart hw
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../handcart-hw/handcart/" class="md-nav__link">
        Handcart / Charger
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Handcart Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Handcart Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Handcart Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../handcart-sw/main/" class="md-nav__link">
        Handcart Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-check-your-configuration" class="md-nav__link">
    Step 1: Check Your Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-follow-this-flowchart" class="md-nav__link">
    Step 2: Follow This Flowchart
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-find-more-details-from-the-flowchart" class="md-nav__link">
    Step 3: Find More Details From The Flowchart
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Find More Details From The Flowchart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#can-transceiver-not-communicating-with-the-mcu" class="md-nav__link">
    CAN Transceiver not communicating with the MCU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#termination-resistors-not-present-or-of-incorrect-value" class="md-nav__link">
    Termination resistors not present or of incorrect value
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-of-errors-raised-by-the-hal-library" class="md-nav__link">
    List of errors raised by the HAL library
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clock-skew" class="md-nav__link">
    Clock Skew
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-fifos-or-mailboxes-are-not-properly-cleared" class="md-nav__link">
    Hardware FIFOs or Mailboxes are not properly cleared
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-segmentation-fault-or-other-error-crashes-the-mcu" class="md-nav__link">
    A segmentation fault or other error crashes the MCU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filters-not-configured-properly" class="md-nav__link">
    Filters not configured properly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interrupts-not-configured-properly" class="md-nav__link">
    Interrupts not configured properly
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="can-bus-troubleshooting">CAN-bus Troubleshooting</h1>
<h2 id="step-1-check-your-configuration">Step 1: Check Your Configuration</h2>
<p>Check that your CubeMX configuration and your code precisely match what is detailed in <a href="../can-config/">CAN-bus Configuration</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be sure to activate all error interrupts and log them properly, otherwise you'll have no way of knowing what is failing and how to fix it.</p>
</div>
<h2 id="step-2-follow-this-flowchart">Step 2: Follow This Flowchart</h2>
<p>Find your problem in the flowchart below and more details in the next chapter.</p>
<p><img alt="CAN Troubleshooting Flowchart" src="../imgs/can-flowchart.png" /></p>
<h2 id="step-3-find-more-details-from-the-flowchart">Step 3: Find More Details From The Flowchart</h2>
<p>Look for the paragraph regarding your problem and read through.</p>
<h4 id="can-transceiver-not-communicating-with-the-mcu">CAN Transceiver not communicating with the MCU</h4>
<p>While the CAN bus operates on two differential lines, the MCU uses a serial protocol, for which a transceiver is needed (for instance, an MCP2562) that translates the CAN_H and CAN_L signals into CAN_TX and CAN_RX. Absence of communication with this device causes the <code>HAL_CAN_Start</code> call to fail with a timeout error.</p>
<div class="admonition check">
<p class="admonition-title">Check</p>
<p>Check continuity between all relevant pins of the transceiver, the CAN socket, and the MCU pins. Try swapping the transceiver with a new one.</p>
</div>
<hr />
<h4 id="termination-resistors-not-present-or-of-incorrect-value">Termination resistors not present or of incorrect value</h4>
<p><img alt="CAN bus layout" src="../imgs/can-bus.png" /></p>
<p>On a CAN network it is very important that the bus is terminated on both sides by a 120 <span class="arithmatex">\(\Omega\)</span> resistor (<a href="https://e2e.ti.com/blogs_/b/industrial_strength/posts/the-importance-of-termination-networks-in-can-transceivers">interesting article on why</a>). Also note that some devices might already incorporate a termination resistor on their end, so pay attention to how many you put.</p>
<div class="admonition check">
<p class="admonition-title">Check</p>
<p>Verify that resistors are properly connected to the bus and are of the correct value. Check schematics and datasheets for already-present termination resistors on the connected nodes. Use an oscilloscope to ensure that the quality of the signal is good.</p>
</div>
<hr />
<h4 id="list-of-errors-raised-by-the-hal-library">List of errors raised by the HAL library</h4>
<p>CAN errors are defined in the driver file <code>stm32f7xx_hal_can.h</code> as follows:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define HAL_CAN_ERROR_NONE            (0x00000000U)  </span><span class="cm">/*!&lt; No error                                             */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_EWG             (0x00000001U)  </span><span class="cm">/*!&lt; Protocol Error Warning                               */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_EPV             (0x00000002U)  </span><span class="cm">/*!&lt; Error Passive                                        */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_BOF             (0x00000004U)  </span><span class="cm">/*!&lt; Bus-off error                                        */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_STF             (0x00000008U)  </span><span class="cm">/*!&lt; Stuff error                                          */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_FOR             (0x00000010U)  </span><span class="cm">/*!&lt; Form error                                           */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_ACK             (0x00000020U)  </span><span class="cm">/*!&lt; Acknowledgment error                                 */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_BR              (0x00000040U)  </span><span class="cm">/*!&lt; Bit recessive error                                  */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_BD              (0x00000080U)  </span><span class="cm">/*!&lt; Bit dominant error                                   */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_CRC             (0x00000100U)  </span><span class="cm">/*!&lt; CRC error                                            */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_RX_FOV0         (0x00000200U)  </span><span class="cm">/*!&lt; Rx FIFO0 overrun error                               */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_RX_FOV1         (0x00000400U)  </span><span class="cm">/*!&lt; Rx FIFO1 overrun error                               */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_TX_ALST0        (0x00000800U)  </span><span class="cm">/*!&lt; TxMailbox 0 transmit failure due to arbitration lost */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_TX_TERR0        (0x00001000U)  </span><span class="cm">/*!&lt; TxMailbox 0 transmit failure due to transmit error   */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_TX_ALST1        (0x00002000U)  </span><span class="cm">/*!&lt; TxMailbox 1 transmit failure due to arbitration lost */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_TX_TERR1        (0x00004000U)  </span><span class="cm">/*!&lt; TxMailbox 1 transmit failure due to transmit error   */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_TX_ALST2        (0x00008000U)  </span><span class="cm">/*!&lt; TxMailbox 2 transmit failure due to arbitration lost */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_TX_TERR2        (0x00010000U)  </span><span class="cm">/*!&lt; TxMailbox 2 transmit failure due to transmit error   */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_TIMEOUT         (0x00020000U)  </span><span class="cm">/*!&lt; Timeout error                                        */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_NOT_INITIALIZED (0x00040000U)  </span><span class="cm">/*!&lt; Peripheral not initialized                           */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_NOT_READY       (0x00080000U)  </span><span class="cm">/*!&lt; Peripheral not ready                                 */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_NOT_STARTED     (0x00100000U)  </span><span class="cm">/*!&lt; Peripheral not started                               */</span><span class="cp"></span>
<span class="cp">#define HAL_CAN_ERROR_PARAM           (0x00200000U)  </span><span class="cm">/*!&lt; Parameter error                                      */</span><span class="cp"></span>
</code></pre></div>
<p>In general, bus-related and protocol-related errors (<strong>protocol error warning, error passive, bus-off, stuff error, form error, ACK error, bit dominant, bit recessive, CRC error</strong>) indicate either an electric problem with the wiring, or an underlying issue with the clock precision or frequency.</p>
<div class="admonition check">
<p class="admonition-title">Check</p>
<p>Double check with a multimeter that the bus is wired properly and that any jumpers make good contact. Use an oscilloscope to ensure that the signal is clear from interference and edges are sharp. Connect a logic analyzer to better understand the communication issue at binary level. See the <a href="#clock-skew">Clock Skew</a> section and double-check that the configured frequencies match the oscillators.</p>
</div>
<p>Firmware-related errors such as overruns or transmit failures may instead indicate an overly congested network or a mistake by the developer when invoking low-level API calls.</p>
<div class="admonition check">
<p class="admonition-title">Check</p>
<p>Test your device with less traffic to ensure that the performance of the MCU is suitable for the application. If you are using only two devices, try connecting a third one to better understand where and how the errors generate. Carefully compare your code with the HAL and ST application notes.</p>
</div>
<hr />
<h4 id="clock-skew">Clock Skew</h4>
<p>ST's MCUs incorporate an internal low-cost 16MHz crystal (called HSI in the clock tree - <em>High Speed Internal</em>) which is factory calibrated with a precision up to 1%. However, due to its low accuracy especially with temperature variations of the chip, peripherals can often encounter timing problems, in particular if running at higher frequencies generated by the PLL.</p>
<div class="admonition check">
<p class="admonition-title">Check</p>
<p>Set-up an external crystal (HSE) and configure the MCU for the correct frequency. Check at runtime that the HSI is not being used as a fallback after a configuration error with a condition like <code>if (__HAL_RCC_GET_SYSCLK_SOURCE() == RCC_SYSCLKSOURCE_HSE)</code>.</p>
</div>
<hr />
<h4 id="hardware-fifos-or-mailboxes-are-not-properly-cleared">Hardware FIFOs or Mailboxes are not properly cleared</h4>
<p>For MCUs with transmissions managed via mailboxes, the developer enqueues a new message to send by calling <code>HAL_CAN_AddTxMessage(...)</code> and providing as a last argument the address of a <code>uint32_t</code> variable in which the function will store the ID of the first free mailbox found. Errors may arise in two occasions: either the function is being called so frequently that the bus has no time to send and empty a slot, or no one is listening on the bus and the "Automatic Retransmission" option is set, making the MCU hang in a loop where it unsuccessfully tries to send messages over and over again.</p>
<p>Conversely, reception queues might as well fill up and cause overruns if they are not read often enough or the network is so congested that the MCU cannot keep up.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When a CAN message arrives and its ISR is triggered, remember to call <code>HAL_CAN_GetRxMessage(...)</code> to clear the reception slot, otherwise an overrun will occur after few messages.</p>
</div>
<div class="admonition check">
<p class="admonition-title">Check</p>
<p>If errors happen when transmitting, make sure you are not sending too frequently and either have free mailboxes available (check with <code>HAL_CAN_GetTxMailboxesFreeLevel(...)</code>) or a software queue to temporarily store your pending packets.</p>
<p>If instead they happen upon reception, test your code with as little incoming traffic as possible and try to understand if your MCU and your software architecture match the intended network performance. Always remember to also properly configure your hardware filters in order to only process what's necessary and not waste resources and CPU cycles.</p>
</div>
<hr />
<h4 id="a-segmentation-fault-or-other-error-crashes-the-mcu">A segmentation fault or other error crashes the MCU</h4>
<p>The ST drivers and HAL library are generally very solid, so I advise to thoroughly check your code for memory leaks (if the MCU runs out of memory it simply stops) or possible sources of segmentation faults such as handling of pointers or calls to low-level functions like <code>memcpy</code> and such. Remember that if the firmware crashes you won't see any error message printed over serial, the processor will just freeze and stop.</p>
<div class="admonition check">
<p class="admonition-title">Check</p>
<p>Print debug statements over UART or blink on-board LEDs to make sure your code keeps executing or, in fact, stops after a while. Use your IDE built-in debugging tools to interface with OpenOCD and find the exact instruction on which the crash happens.</p>
</div>
<hr />
<h4 id="filters-not-configured-properly">Filters not configured properly</h4>
<p>If a message is discarded by a hardware filter you will not receive interrupts of any kind.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Disabling filters will cause every message to be discarded, contrary to what you might expect.</p>
</div>
<div class="admonition check">
<p class="admonition-title">Check</p>
<p>Carefully read the filter configuration section in <a href="../can-config/">CAN-bus Configuration</a> and ensure your filters are behaving as you intend.</p>
</div>
<hr />
<h4 id="interrupts-not-configured-properly">Interrupts not configured properly</h4>
<p>For interrupts to be raised by the MCU, they need to be properly configured both from CubeMX and in your code.</p>
<div class="admonition check">
<p class="admonition-title">Check</p>
<p>Verify that you followed the correct procedure detailed in the Interrupt section in <a href="../can-config/">CAN-bus Configuration</a>.</p>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../can-config/" class="md-footer__link md-footer__link--prev" aria-label="Previous: CAN-bus Configuration" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              CAN-bus Configuration
            </div>
          </div>
        </a>
      
      
        
        <a href="../openocd-errors/" class="md-footer__link md-footer__link--next" aria-label="Next: OpenOCD Troubleshooting" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              OpenOCD Troubleshooting
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; E-Agle TRT
          </div>
        
        
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/eagletrt" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://github.com/eagletrt" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://hub.docker.com/u/eagletrt" target="_blank" rel="noopener" title="hub.docker.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b1047164.min.js"></script>
      
        <script src="../../../static/js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
      
        <script src="../../../static/js/mermaid.js"></script>
      
    
  </body>
</html>