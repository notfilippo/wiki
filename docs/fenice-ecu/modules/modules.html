<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modules &mdash; E-Agle TRT Wiki  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/dev.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script src="../../../_static/js/custom.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="prev" title="Finite State Machine" href="../fsm/fsm.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about/index.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../about/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../about/writing-docs.html">Writing Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../about/writing-docs.html#notes-and-warnings">Notes and warnings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../about/writing-docs.html#mathematical-expressions">Mathematical expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../about/writing-docs.html#embedding-pdfs">Embedding PDFs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../common/index.html">Common</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../common/openocd-errors.html">OpenOCD errors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../common/openocd-errors.html#error-connecting-dp-cannot-read-idr">Error connecting DP: cannot read IDR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../common/openocd-errors.html#conditions">CONDITIONS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../common/openocd-errors.html#solution">SOLUTION</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Steering Wheel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fenice-steeringwheel/index.html">Steering Wheel</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html">Building Qt for the Raspberry Pi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#prerequites">Prerequites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#a-hardware">A. Hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#b-software">B. Software</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#c-others">C. Others</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#setup-the-target-machine">Setup the Target Machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#start-from-scratch-optional">1. Start from Scratch <em>(Optional)</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#set-up-ssh">2. Set up SSH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#open-terminal">3. Open Terminal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#enable-gl-fake-kms">4. Enable GL (FAKE KMS)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#enable-development-sources">5. Enable Development Sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#update-the-system">6. Update the system</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#enable-rsync-with-elevated-rights">7. Enable rsync with elevated rights</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#install-the-important-development-packages">8. Install the important Development Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#additional-packages-optional">9. Additional packages (Optional)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#create-directory-for-qt-deployment">10. Create directory for QT Deployment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#setup-the-host-machine">Setup the Host Machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#update-the-host-machine">1. Update the Host Machine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#setting-up-the-directory-structure">2. Setting up the directory structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#download-extract-qt-source">3. Download &amp; Extract QT Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#patching-qt-source">4. Patching QT Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#download-extract-the-precompiled-cross-compiler">5. Download &amp; Extract the Precompiled Cross-Compiler</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#sync-raspberry-pi-sysroot-most-important">6. Sync Raspberry Pi sysroot (Most Important)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#fix-symbolic-links">7. Fix symbolic links</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#configure-qt-build">8. Configure QT Build</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#build-qt-source">9. Build QT Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#install-qt-source">10. Install QT Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#deploy-qt-to-raspberry-pi">11. Deploy QT to Raspberry Pi</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#final-step-for-target-machine">Final Step for Target Machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../fenice-steeringwheel/development/qt.html#update-linker-on-raspberry-pi">Update linker on Raspberry Pi</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../fenice-steeringwheel/interface/tabs.html">Concept of Tabs</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BMS HV</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../fenice-bms-hv/index.html">High-Voltage Battery Management System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../fenice-bms-hv/mainboard/index.html">Mainboard</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../fenice-bms-hv/mainboard/io.html">I/O Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fenice-bms-hv/mainboard/bms_fsm.html">BMS FSM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fenice-bms-hv/mainboard/bms_fsm.html#idle">- Idle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fenice-bms-hv/mainboard/bms_fsm.html#pre-charge">- Pre-Charge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fenice-bms-hv/mainboard/bms_fsm.html#ts-on">- TS_On</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fenice-bms-hv/mainboard/bms_fsm.html#error">- Error</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CAN CICD</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../can-cicd/index.html">Build branch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../can-cicd/index.html#subprojects-output-files">Subprojects’ output files</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/index.html">Welcome to Eagletrt ubx parser master’s documentation!</a><ul class="simple">
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ECU</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Electronic Control Unit</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../fsm/fsm.html">Finite State Machine</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#uart">UART</a></li>
<li class="toctree-l3"><a class="reference internal" href="#timers">Timers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buzzer">Buzzer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#can">CAN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#networks">Networks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bit-timing-parameters">Bit Timing Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#messages">Messages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#spi">SPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imu">IMU</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sensor-configuration">Sensor Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#irts">IRTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inverters">Inverters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#status-register-contents">Status Register Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#current-torque-curve-and-power-limiting">Current-Torque Curve and Power Limiting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pcu">PCU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tractive-system">Tractive System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#traction-control">Traction Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encoders">Encoders</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">E-Agle TRT Wiki</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Electronic Control Unit</a> &raquo;</li>
      <li>Modules</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/docs/fenice-ecu/modules/modules.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="modules">
<h1>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h1>
<section id="uart">
<h2>UART<a class="headerlink" href="#uart" title="Permalink to this headline">¶</a></h2>
<p>Several serial communication interfaces are used:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>TX Pin</p></th>
<th class="head"><p>RX Pin</p></th>
<th class="head"><p>Baud Rate</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>UART4</p></td>
<td><p>PA12</p></td>
<td><p>PA13</p></td>
<td><p>115200</p></td>
<td><p>Debugging messages</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>Front Right Encoder</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>Front Left Encoder</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>Steering Encoder</p></td>
</tr>
</tbody>
</table>
<p>For more details on the encoders, see <a class="reference external" href="#encoders">the dedicated section below</a>.</p>
</section>
<hr class="docutils" />
<section id="timers">
<h2>Timers<a class="headerlink" href="#timers" title="Permalink to this headline">¶</a></h2>
<p>List of STM timers employed:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Timer</p></th>
<th class="head"><p>Pin</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TIM10</p></td>
<td><p>PB8</p></td>
<td><p>Buzzer PWM output</p></td>
</tr>
</tbody>
</table>
</section>
<hr class="docutils" />
<section id="buzzer">
<h2>Buzzer<a class="headerlink" href="#buzzer" title="Permalink to this headline">¶</a></h2>
<p>As required by the rulebook, the ECU must beep a buzzer for at least (?) …</p>
<p>The buzzer is driven by a MOSFET operated via the PWM output generated by the TIM10 timer on pin PB8, and powered by the 12V line.</p>
</section>
<hr class="docutils" />
<section id="can">
<h2>CAN<a class="headerlink" href="#can" title="Permalink to this headline">¶</a></h2>
<p>Fenice’s internal networks operate on two CAN buses.</p>
<section id="networks">
<h3>Networks<a class="headerlink" href="#networks" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Network</p></th>
<th class="head"><p>Interface</p></th>
<th class="head"><p>CAN_TX Pin</p></th>
<th class="head"><p>CAN_RX Pin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Primary</p></td>
<td><p>CAN1</p></td>
<td><p>PD1</p></td>
<td><p>PD0</p></td>
</tr>
<tr class="row-odd"><td><p>Secondary</p></td>
<td><p>CAN3</p></td>
<td><p>PB4</p></td>
<td><p>PA8</p></td>
</tr>
</tbody>
</table>
</section>
<section id="bit-timing-parameters">
<h3>Bit Timing Parameters<a class="headerlink" href="#bit-timing-parameters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>APB1 Peripheral Clock (PCLK1): <strong>54 MHz</strong></p></li>
<li><p>Prescaler: <strong>3</strong></p>
<ul>
<li><p><em>Time Quantum is therefore 55.555 ns</em></p></li>
</ul>
</li>
<li><p>Time Quanta in Bit Segment 1: <strong>12</strong></p></li>
<li><p>Time Quanta in Bit Segment 2: <strong>5</strong></p>
<ul>
<li><p><em>Time for one bit is therefore 999.99 ns</em></p></li>
<li><p><em>Baud rate is therefore 1000000 bps (<strong>1 Mbit/s</strong>)</em></p></li>
</ul>
</li>
<li><p>ReSynchronization Jump Width: <strong>1</strong></p></li>
</ul>
</section>
<section id="messages">
<h3>Messages<a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h3>
<p>For the list and definition of all CAN messages please refer to the <span class="xref myst">can-cicd documentation</span>.</p>
</section>
</section>
<hr class="docutils" />
<section id="spi">
<h2>SPI<a class="headerlink" href="#spi" title="Permalink to this headline">¶</a></h2>
<p>The SPI interface is used to communicate with the Traction Control Unit and exchange information on vehicle state and motor torque. Since the TCU runs on a Raspberry Pi which is, by design, only capable of operating as a Master node, the ECU acts as the Slave node.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>CLK Pin</p></th>
<th class="head"><p>…</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>…</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p>For more information on how and what information is exchanged, please refer to the <a class="reference external" href="#traction-control">Traction Control</a> section below.</p>
</section>
<hr class="docutils" />
<section id="imu">
<h2>IMU<a class="headerlink" href="#imu" title="Permalink to this headline">¶</a></h2>
<p>This module records the acceleration data coming from the Inertial Measurement Unit (IMU) sensor over the CAN network.</p>
<p>Namely, it receives:</p>
<ul class="simple">
<li><p>Linear acceleration on the three directions</p></li>
<li><p>Gyroscopic acceleration on the three axes</p></li>
</ul>
<section id="sensor-configuration">
<h3>Sensor Configuration<a class="headerlink" href="#sensor-configuration" title="Permalink to this headline">¶</a></h3>
<p>In order to work properly, the sensor needs to be configured with the following parameters:</p>
<ul class="simple">
<li><p>Sampling frequency: ?</p></li>
<li><p>…</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="irts">
<h2>IRTS<a class="headerlink" href="#irts" title="Permalink to this headline">¶</a></h2>
<p>Four Infra-Red Temperature Sensors (IRTSs) are pointed toward the tires and measure their temperature gradient using 8 (?) channels each (…)</p>
</section>
<hr class="docutils" />
<section id="inverters">
<h2>Inverters<a class="headerlink" href="#inverters" title="Permalink to this headline">¶</a></h2>
<p>The Inverters and the ECU communicate over the CAN network and exchange the following information:</p>
<ul class="simple">
<li><p>The ECU periodically (at which freq. ?) sends two torque values to be applied to the motors, one for the left side and one for the right side</p></li>
<li><p>The inverters periodically (every 100ms) report the contents of their status register (more details below)</p></li>
<li><p>The inverters periodically (every 100ms) report the output voltage at which they are driving the motors</p></li>
</ul>
<section id="status-register-contents">
<h3>Status Register Contents<a class="headerlink" href="#status-register-contents" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Bit</p></th>
<th class="head"><p>Symbol</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Ena</p></td>
<td><p>Drive Enable</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>RcR0</p></td>
<td><p>Speed limit to zero</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Lim+</p></td>
<td><p>Limited switch + tripped</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Lim-</p></td>
<td><p>Limited switch - tripped</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>OK</p></td>
<td><p>Drive okay</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Icns</p></td>
<td><p>Current is limited to the continuous current level</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>T-Nlim</p></td>
<td><p>Speed limit torque mode active</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>P-N</p></td>
<td><p>Position control active</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>N-I</p></td>
<td><p>Speed control active</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>&lt;N0</p></td>
<td><p>Actual speed is less than 0.1%</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>Rsw</p></td>
<td><p>Reference switch tripped</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>Cal0</p></td>
<td><p>Calibration move active</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>Cal</p></td>
<td><p>Calibration move completed</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>Tol</p></td>
<td><p>Position within tolerance window</p></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>Rdy</p></td>
<td><p>Drive ready (BTB/RDY contact closed)</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>Brk0</p></td>
<td><p>Unexcited brake with motor active</p></td>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>SignMag</p></td>
<td><p>Speed internally inverted</p></td>
</tr>
<tr class="row-odd"><td><p>17</p></td>
<td><p>Nclip</p></td>
<td><p>Speed limiting enabled (N-Lim &lt; 90%)</p></td>
</tr>
<tr class="row-even"><td><p>18</p></td>
<td><p>Nclip+</p></td>
<td><p>Speed limiting (+) via input switch enabled</p></td>
</tr>
<tr class="row-odd"><td><p>19</p></td>
<td><p>Ncip-</p></td>
<td><p>Speed limiting (-) via input switch enabled</p></td>
</tr>
<tr class="row-even"><td><p>20</p></td>
<td><p>Ird-Dig</p></td>
<td><p>Current limiting via input switch  enabled</p></td>
</tr>
<tr class="row-odd"><td><p>21</p></td>
<td><p>Iuse-rchd</p></td>
<td><p>Actual current limit reached</p></td>
</tr>
<tr class="row-even"><td><p>22</p></td>
<td><p>Ird-N</p></td>
<td><p>Current derating to cont. current via speed limit enabled</p></td>
</tr>
<tr class="row-odd"><td><p>23</p></td>
<td><p>Ird-TI</p></td>
<td><p>Current derating to cont. current due to igbt temp. enabled</p></td>
</tr>
<tr class="row-even"><td><p>24</p></td>
<td><p>Ird-TIR</p></td>
<td><p>Current derating to cont. current due to igbt temp. active</p></td>
</tr>
<tr class="row-odd"><td><p>25</p></td>
<td><p>&gt;10Hz</p></td>
<td><p>Current derating to cont. current at rotation freq. &lt; 10 Hz active</p></td>
</tr>
<tr class="row-even"><td><p>26</p></td>
<td><p>Ird-TM</p></td>
<td><p>Current derating to cont. current due to motor temp. active</p></td>
</tr>
<tr class="row-odd"><td><p>27</p></td>
<td><p>Ird-Ana</p></td>
<td><p>Current derating due to analog input (if &lt;= 90%) possible</p></td>
</tr>
<tr class="row-even"><td><p>28</p></td>
<td><p>Iwcns</p></td>
<td><p>Current peak value warning</p></td>
</tr>
<tr class="row-odd"><td><p>29</p></td>
<td><p>RFEpulse</p></td>
<td><p>Pulsed RFE - input monitoring active</p></td>
</tr>
<tr class="row-even"><td><p>30</p></td>
<td><p>M+d</p></td>
<td><p>vacant</p></td>
</tr>
<tr class="row-odd"><td><p>31</p></td>
<td><p>HndWhl</p></td>
<td><p>Hand-wheel function selected</p></td>
</tr>
</tbody>
</table>
</section>
<section id="current-torque-curve-and-power-limiting">
<h3>Current-Torque Curve and Power Limiting<a class="headerlink" href="#current-torque-curve-and-power-limiting" title="Permalink to this headline">¶</a></h3>
<p>Since, for a given current, power absorption of the motors is proportional to their rotational speed, and given that inverters are controlled in torque/current mode, care must be taken not to request more than the allowed limit of 80 KWh.</p>
<p>More details on the matter are available in this report:

                        <iframe
                                id="ID"
                                style="border:1px solid #666CCC"
                                title="PDF"
                                src="./Powertrain_Transmission_Optimal_Parameters.pdf"
                                frameborder="1"
                                scrolling="auto"
                                height="400"
                                width="100%"
                                align="middle">
                        </iframe>
                     </p>
<p>Essentially, requesting the maximum available current of 200A when the angular velocity is above 4000 RPM causes the power to exceed the allowed limit. To overcome this issue, the following equation must then be followed to obtain the correct torque limit at each rotational speed:</p>
<p><span class="math notranslate nohighlight">\(C_{mot\_max} =
    \begin{cases}
      C_{max} &amp; \text{if \)</span>\omega_{mot} &lt; \omega_{limit}<span class="math notranslate nohighlight">\(} \\
      \frac{358098.6}{\omega_{mot}} &amp; \text{if \)</span>\omega_{mot} \geq \omega_{limit}<span class="math notranslate nohighlight">\(}\)</span></p>
</section>
</section>
<hr class="docutils" />
<section id="pcu">
<h2>PCU<a class="headerlink" href="#pcu" title="Permalink to this headline">¶</a></h2>
<p>This module controls all communication (via CAN-Bus) between the ECU and the Pedal Control Unit (PCU). More specifically:</p>
<ul class="simple">
<li><p>ADC brake and accelerator values are read and scaled from 0 to 100</p></li>
<li><p>Errors and Warnings are checked (e.g. implausibility)</p></li>
<li><p>Calibration values are read/written from/to the EEPROM and sent/received</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="tractive-system">
<h2>Tractive System<a class="headerlink" href="#tractive-system" title="Permalink to this headline">¶</a></h2>
<p>The TC code handles the generation and delivery of messages concerning the status of the BMS-HV (PRECHARGE, TS-ON, TS-OFF, …).</p>
</section>
<hr class="docutils" />
<section id="traction-control">
<h2>Traction Control<a class="headerlink" href="#traction-control" title="Permalink to this headline">¶</a></h2>
<p>Since the actual software for controlling the traction of the vehicle runs on a separate device (for reliability purposes), the ECU and the Traction Control Unit (TCU) need to constantly exchange a number of values.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Brake</p></td>
<td><p>ECU -&gt; TCU</p></td>
<td><p>How much the brake pedal is pressed</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p>Further technical details on how this data is exchanged over SPI can be found at the <a class="reference external" href="#?">TCU Protocol</a> page.</p>
</section>
<hr class="docutils" />
<section id="encoders">
<h2>Encoders<a class="headerlink" href="#encoders" title="Permalink to this headline">¶</a></h2>
<p>…</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../fsm/fsm.html" class="btn btn-neutral float-left" title="Finite State Machine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, E-Agle Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>